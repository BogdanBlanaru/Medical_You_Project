<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <changeSet id="db.changelog.202601260002-create-appointments-table" author="Claude">
        <sql>
            CREATE TABLE IF NOT EXISTS appointments (
                id SERIAL PRIMARY KEY,
                doctor_id INTEGER NOT NULL,
                patient_id INTEGER NOT NULL,
                appointment_date TIMESTAMP NOT NULL,
                status VARCHAR(20) NOT NULL DEFAULT 'SCHEDULED',
                reason VARCHAR(500),
                notes VARCHAR(1000),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                is_cancelled BOOLEAN NOT NULL DEFAULT FALSE,
                CONSTRAINT fk_appointment_doctor FOREIGN KEY (doctor_id) REFERENCES doctors(id) ON DELETE CASCADE,
                CONSTRAINT fk_appointment_patient FOREIGN KEY (patient_id) REFERENCES patients(id) ON DELETE CASCADE
            );

            CREATE INDEX idx_appointments_doctor_id ON appointments(doctor_id);
            CREATE INDEX idx_appointments_patient_id ON appointments(patient_id);
            CREATE INDEX idx_appointments_date ON appointments(appointment_date);
            CREATE INDEX idx_appointments_status ON appointments(status);
        </sql>
    </changeSet>
</databaseChangeLog>
